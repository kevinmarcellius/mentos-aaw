sources:
  logfile:
    type: file
    include:
      - ./var/log/data/authentication/*.log

transforms:
  parse_json:
    type: remap
    inputs:
      - logfile
    source: |
      del(.file)
      del(.source_type)
      . = parse_json!(.message)
      .time = now()
      
sinks:
  loki:
    type: loki
    inputs:
      - parse_json
    compression: snappy
    endpoint: http://loki.logging.svc.cluster.local:3100
    labels:
      container: app-auth
      stream: stream-auth
      level: "{{ .level }}"
      hostname: "{{ .hostname }}"
      pid: "{{ .pid }}"
    encoding:
      codec: json
